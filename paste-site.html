
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://blog.gtmanfred.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://blog.gtmanfred.com/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://blog.gtmanfred.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://blog.gtmanfred.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://blog.gtmanfred.com/theme/font-awesome/css/solid.css">


    <link href="https://blog.gtmanfred.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="GTmanfred Atom">



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42514099-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333">

<meta name="author" content="Daniel Wallace" />
<meta name="description" content="Probley because KaiSforza was complaining about it." />
<meta name="keywords" content="pastebin">

<meta property="og:site_name" content="GTmanfred"/>
<meta property="og:title" content="Why the hell would I want my own paste site? ¬Ø\(¬∞_o)/¬Ø"/>
<meta property="og:description" content="Probley because KaiSforza was complaining about it."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://blog.gtmanfred.com/paste-site.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2013-08-12 21:00:00-05:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://blog.gtmanfred.com/author/daniel-wallace.html">
<meta property="article:section" content="Pelican"/>
<meta property="article:tag" content="pastebin"/>
<meta property="og:image" content="https://blog.gtmanfred.com/images/profile.png">

  <title>GTmanfred &ndash; Why the hell would I want my own paste site? ¬Ø\(¬∞_o)/¬Ø</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://blog.gtmanfred.com">
        <img src="https://blog.gtmanfred.com/images/profile.png" alt="" title="">
      </a>
      <h1><a href="https://blog.gtmanfred.com"></a></h1>


      <nav>
        <ul class="list">
          <li><a href="https://blog.gtmanfred.com/pages/about.html#about">About</a></li>

        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-linkedin" href="https://br.linkedin.com/in/danielwallace90/en" target="_blank">
            <i class="fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-github" href="https://github.com/gtmanfred" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-twitter" href="https://twitter.com/gtmanfred" target="_blank">
            <i class="fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-reddit" href="https://reddit.com/u/gtmanfred" target="_blank">
            <i class="fab fa-reddit">
            </i>
          </a></li>
          <li>
            <a  class="sc-rss" href="/feeds/all.atom.xml" target="_blank">
            <i class="fas fa-rss">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://blog.gtmanfred.com">Home</a>


      <a href="https://blog.gtmanfred.com/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="paste-site">Why the hell would I want my own paste site? ¬Ø\(¬∞_o)/¬Ø</h1>
    <p>
      Posted on Mon 12 August 2013 in <a href="https://blog.gtmanfred.com/category/pelican.html">Pelican</a>

        &#8226; 5 min read
    </p>
  </header>


  <div>
    <h1>Where to get everything</h1>
<h3>Edit: perl-cpanplus-dist-arch</h3>
<p>I now have the perl modules installed using cpanplus</p>
<div class="highlight"><pre><span></span>pacman -Syu perl-cpanplus-dist-arch
setupdistarch
cpanp i HTML::FromANSI
</pre></div>


<p>This will package them so that they are owned and maintained by pacman.</p>
<div class="highlight"><pre><span></span>‚îî‚îÄ‚ïº pacman -Si perl-html-fromansi                                        
Repository     : gtmanfred
Name           : perl-html-fromansi
Version        : 2.03-1
Description    : converts ANSI text sequences to corresponding HTML codes
Architecture   : any
URL            : http://search.cpan.org/~NUFFIN/HTML-FromANSI-2.03/
Licenses       : GPL  PerlArtistic
Groups         : None
Provides       : None
Depends On     : perl&amp;gt;=5.10.0
Optional Deps  : None
Conflicts With : None
Replaces       : None
Download Size  :  12.35 KiB
Installed Size :  63.00 KiB
Packager       : Daniel Wallace &amp;lt;danielwallace at gtmanfred dot com&amp;gt;
Build Date     : Fri 09 Aug 2013 09:24:04 PM CDT
Validated By   : MD5 Sum  SHA256 Sum  Signature
</pre></div>


<p><a href="http://git.server-speed.net/users/flo/filebin/">Filebin</a> is pretty simple, all you need to do
is git clone it into your document root.</p>
<div class="highlight"><pre><span></span>git clone git://git.server-speed.net/users/flo/filebin/ /srv/http/paste.gtmanfred.com
</pre></div>


<p>Anything else need to be said? Oh right, I had problems with the cpan dependencies and what
not for HTML::FromANSI.  I ended up just installing them into my users ~/.cpan directory, then
just moving them to /usr/share/parl5/site_perl instead of packaging them because I didn't see
them in the Arch Linux repositories.</p>
<div class="highlight"><pre><span></span>perl-text-markdown
php-memcache
qrencode
python2-pygments
</pre></div>


<p>And then a database, I chose to use mariadb because I have been using MySQL so much at work, i
want some practice with it outside of work as well.</p>
<h1>Setting up the config files</h1>
<p>So I just followed the instructions in
<a href="http://git.server-speed.net/users/flo/filebin/tree/INSTALL">INSTALl</a> for the most part.</p>
<div class="highlight"><pre><span></span>cd /srv/http/paste.gtmanfred.com
cp -av application/config/example/* application/config
cp -av data/local/examples/contact-info.php data/local/
</pre></div>


<p>Next you need to setup the databases for mariadb or w/e databse you are going to use.</p>
<div class="highlight"><pre><span></span>mysql -u root
MariaDB [(none)]&amp;gt; create database pastes;
Query OK, 1 row affected (0.02 sec)

MariaDB [(none)]&amp;gt; create user &#39;pastes&#39;@&#39;localhost&#39; identified by &#39;&amp;lt;password&amp;gt;&#39;;
Query OK, 0 rows affected (0.10 sec)

MariaDB [(none)]&amp;gt; Grant all privileges on pastes.* to &#39;pastes&#39;@&#39;localhost&#39;;
Query OK, 0 rows affected (0.04 sec)
</pre></div>


<p>After this point, I started setting up the config-local.php like was described in
<a href="http://git.server-speed.net/users/flo/filebin/tree/INSTALL">INSTALL</a></p>
<div class="highlight"><pre><span></span>‚ïò‚ïêüò∏ tail -c +0 config-local.php database.php
==&amp;gt; config-local.php &amp;lt;==
&amp;lt;?php  if ( ! defined(&#39;BASEPATH&#39;)) exit(&#39;No direct script access allowed&#39;);

/*
 * Use this file to override any settings from config.php
 */

// set this to a 32char random string
$config[&#39;encryption_key&#39;] = &#39;&amp;lt;insert any random string&amp;gt;&#39;;

// shouldn&#39;t be served by the webserver
$config[&#39;upload_path&#39;] = FCPATH.&#39;data/uploads&#39;;

// don&#39;t show index.php in the url
$config[&#39;index_page&#39;] = &#39;&#39;;


==&amp;gt; database.php &amp;lt;==
&amp;lt;?php  if ( ! defined(&#39;BASEPATH&#39;)) exit(&#39;No direct script access allowed&#39;);
/*
| -------------------------------------------------------------------
| DATABASE CONNECTIVITY SETTINGS
| -------------------------------------------------------------------
| This file will contain the settings needed to access your database.
|
| For complete instructions please consult the &#39;Database Connection&#39;
| page of the User Guide.
|
| -------------------------------------------------------------------
| EXPLANATION OF VARIABLES
| -------------------------------------------------------------------
|
|   [&#39;hostname&#39;] The hostname of your database server.
|   [&#39;username&#39;] The username used to connect to the database
|   [&#39;password&#39;] The password used to connect to the database
|   [&#39;database&#39;] The name of the database you want to connect to
|   [&#39;dbdriver&#39;] The database type. ie: mysql.  Currently supported:
                 mysql, mysqli, postgre, odbc, mssql, sqlite, oci8
|   [&#39;dbprefix&#39;] You can add an optional prefix, which will be added
|                to the table name when using the  Active Record class
|   [&#39;pconnect&#39;] TRUE/FALSE - Whether to use a persistent connection
|   [&#39;db_debug&#39;] TRUE/FALSE - Whether database errors should be displayed.
|   [&#39;cache_on&#39;] TRUE/FALSE - Enables/disables query caching
|   [&#39;cachedir&#39;] The path to the folder where cache files should be stored
|   [&#39;char_set&#39;] The character set used in communicating with the database
|   [&#39;dbcollat&#39;] The character collation used in communicating with the database
|                NOTE: For MySQL and MySQLi databases, this setting is only used
|                as a backup if your server is running PHP &amp;lt; 5.2.3 or MySQL &amp;lt; 5.0.7
|                (and in table creation queries made with DB Forge).
|                There is an incompatibility in PHP with mysql_real_escape_string() which
|                can make your site vulnerable to SQL injection if you are using a
|                multi-byte character set and are running versions lower than these.
|                Sites using Latin-1 or UTF-8 database character set and collation are unaffected.
|   [&#39;swap_pre&#39;] A default table prefix that should be swapped with the dbprefix
|   [&#39;autoinit&#39;] Whether or not to automatically initialize the database.
|   [&#39;stricton&#39;] TRUE/FALSE - forces &#39;Strict Mode&#39; connections
|                           - good for ensuring strict SQL while developing
|
| The $active_group variable lets you choose which connection group to
| make active.  By default there is only one group (the &#39;default&#39; group).
|
| The $active_record variables lets you determine whether or not to load
| the active record class
*/

$active_group = &#39;default&#39;;
$active_record = TRUE;

$db[&#39;default&#39;][&#39;hostname&#39;] = &quot;localhost&quot;;
$db[&#39;default&#39;][&#39;username&#39;] = &quot;pastes&quot;;
$db[&#39;default&#39;][&#39;password&#39;] = &quot;&amp;lt;password&amp;gt;&quot;;
$db[&#39;default&#39;][&#39;database&#39;] = &quot;pastes&quot;;
$db[&#39;default&#39;][&#39;dbdriver&#39;] = &quot;mysqli&quot;;
$db[&#39;default&#39;][&#39;dbprefix&#39;] = &quot;&quot;;
$db[&#39;default&#39;][&#39;pconnect&#39;] = TRUE;
$db[&#39;default&#39;][&#39;db_debug&#39;] = TRUE;
$db[&#39;default&#39;][&#39;cache_on&#39;] = FALSE;
$db[&#39;default&#39;][&#39;cachedir&#39;] = &quot;&quot;;
$db[&#39;default&#39;][&#39;char_set&#39;] = &quot;utf8&quot;;
$db[&#39;default&#39;][&#39;dbcollat&#39;] = &quot;utf8_bin&quot;;
$db[&#39;default&#39;][&#39;swap_pre&#39;] = &#39;&#39;;
$db[&#39;default&#39;][&#39;autoinit&#39;] = TRUE;
$db[&#39;default&#39;][&#39;stricton&#39;] = FALSE;


/* End of file database.php */
/* Location: ./application/config/database.php */
</pre></div>


<h1>Creating your first user</h1>
<p>Go to http://<domain>/user/hash_password and you can create a password hash for your first
user. Then just add them to the mysql database, at this point your tables should have been
generated.</p>
<div class="highlight"><pre><span></span>insert into users (username,password,email,referer) values (&#39;username&#39;, &#39;above hash password&#39;, &#39;email&#39;, 0);
</pre></div>


<p>You should now have everything you need to login, but only on the website. I was unable to get
nginx to pass on the HTTP_AUTHORIZATION header to uwsgi.  Then apikeys were implemented this
same weekend, so I no longer care about them!  <a href="http://paste.gtmanfred.com/user/apikeys">APIKEYS</a></p>
<h1>Setting up nginx and uwsgi</h1>
<p>I struggled with this part because I didn't actually read all of the config.php.  Turns out if
you want to get rid of the index.php from the url, you need to make sure to set
<code>$config['index_page'] = ''</code> and then you can be on your merry way. Below are my nginx and
uwsgi config files.  Remember I am using Uwsgi, but you should be able to mimic this easily
with fcgiwrap.  Also, I am using the uwsgi@.service and uwsgi@.socket from the Arch Linux
package.</p>
<div class="highlight"><pre><span></span><span class="err">‚îî‚îÄ‚ïº</span> <span class="nt">tail</span> <span class="nt">-c</span> <span class="o">+</span><span class="nt">0</span> <span class="o">/</span><span class="nt">etc</span><span class="o">/</span><span class="nt">nginx</span><span class="o">/</span><span class="nt">conf</span><span class="o">/</span><span class="nt">paste</span><span class="p">.</span><span class="nc">gtmanfred</span><span class="p">.</span><span class="nc">com</span><span class="p">.</span><span class="nc">conf</span> <span class="o">/</span><span class="nt">etc</span><span class="o">/</span><span class="nt">uwsgi</span><span class="o">/</span><span class="nt">paste</span><span class="p">.</span><span class="nc">ini</span>
<span class="o">==&amp;</span><span class="nt">gt</span><span class="o">;</span> <span class="o">/</span><span class="nt">etc</span><span class="o">/</span><span class="nt">nginx</span><span class="o">/</span><span class="nt">conf</span><span class="o">/</span><span class="nt">paste</span><span class="p">.</span><span class="nc">gtmanfred</span><span class="p">.</span><span class="nc">com</span><span class="p">.</span><span class="nc">conf</span> <span class="o">&amp;</span><span class="nt">lt</span><span class="o">;==</span>
<span class="nt">server</span> <span class="p">{</span>
    <span class="err">listen</span> <span class="n">fd</span><span class="p">:</span><span class="mi">3</span><span class="p">;</span>
    <span class="err">server_name</span> <span class="err">paste.gtmanfred.com</span><span class="p">;</span>
    <span class="err">root</span> <span class="err">/srv/http/paste.gtmanfred.com</span><span class="p">;</span>
    <span class="err">index</span> <span class="err">index.php</span><span class="p">;</span>
    <span class="err">error_log</span> <span class="err">/var/log/nginx/paste.gtmanfred.com-error_log</span><span class="p">;</span>
    <span class="err">rewrite_log</span> <span class="err">on</span><span class="p">;</span>
    <span class="err">location</span> <span class="err">/</span> <span class="err">{</span>
        <span class="err">try_files</span> <span class="err">$uri</span> <span class="err">$uri/</span> <span class="err">@ee</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nt">location</span> <span class="p">@</span><span class="k">ee</span> <span class="p">{</span>
        <span class="nt">rewrite</span> <span class="o">^(.*)</span> <span class="o">/</span><span class="nt">index</span><span class="p">.</span><span class="nc">php</span><span class="o">?$</span><span class="nt">1</span> <span class="nt">last</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="nt">location</span> <span class="o">~</span> <span class="err">\</span><span class="p">.</span><span class="nc">php</span><span class="o">$</span> <span class="p">{</span>
        <span class="err">include</span> <span class="err">uwsgi_params</span><span class="p">;</span>
        <span class="err">uwsgi_modifier1</span> <span class="err">14</span><span class="p">;</span>
        <span class="err">uwsgi_pass</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8090</span><span class="p">;</span>
        <span class="err">uwsgi_pass_request_headers</span> <span class="err">on</span><span class="p">;</span>
        <span class="err">uwsgi_pass_header</span> <span class="err">HTTP_AUTHENTICATION</span><span class="p">;</span>
    <span class="p">}</span>

<span class="err">}</span>

<span class="o">==&amp;</span><span class="nt">gt</span><span class="o">;</span> <span class="o">/</span><span class="nt">etc</span><span class="o">/</span><span class="nt">uwsgi</span><span class="o">/</span><span class="nt">paste</span><span class="p">.</span><span class="nc">ini</span> <span class="o">&amp;</span><span class="nt">lt</span><span class="o">;==</span>

<span class="cp">[</span><span class="nx">uwsgi</span><span class="cp">]</span>
<span class="o">;</span> <span class="nt">load</span> <span class="nt">plugins</span>
<span class="nt">plugins</span> <span class="o">=</span> <span class="nt">php</span>

<span class="nt">gid</span><span class="o">=</span><span class="nt">users</span>
<span class="nt">uid</span><span class="o">=</span><span class="nt">git</span>


<span class="o">;</span> <span class="nt">our</span> <span class="nt">working</span> <span class="nt">dir</span>
<span class="nt">project_dir</span> <span class="o">=</span> <span class="o">/</span><span class="nt">srv</span><span class="o">/</span><span class="nt">http</span><span class="o">/</span><span class="nt">paste</span><span class="p">.</span><span class="nc">gtmanfred</span><span class="p">.</span><span class="nc">com</span>

<span class="o">;</span> <span class="nt">chdir</span> <span class="nt">to</span> <span class="nt">it</span> <span class="o">(</span><span class="nt">just</span> <span class="nt">for</span> <span class="nt">fun</span><span class="o">)</span>
<span class="nt">chdir</span> <span class="o">=</span> <span class="o">%(</span><span class="nt">project_dir</span><span class="o">)</span>


<span class="o">;</span> <span class="nt">reload</span> <span class="nt">whenever</span> <span class="nt">this</span> <span class="nt">config</span> <span class="nt">file</span> <span class="nt">changes</span>
<span class="o">;</span> <span class="o">%</span><span class="nt">p</span> <span class="nt">is</span> <span class="nt">the</span> <span class="nt">full</span> <span class="nt">path</span> <span class="nt">of</span> <span class="nt">the</span> <span class="nt">current</span> <span class="nt">config</span> <span class="nt">file</span>
<span class="nt">touch-reload</span> <span class="o">=</span> <span class="o">%</span><span class="nt">p</span>

<span class="o">;</span> <span class="nt">run</span> <span class="nt">with</span> <span class="nt">at</span> <span class="nt">least</span> <span class="nt">2</span> <span class="nt">processes</span> <span class="nt">but</span> <span class="nt">increase</span> <span class="nt">upto</span> <span class="nt">8</span> <span class="nt">when</span> <span class="nt">needed</span>
<span class="nt">master</span> <span class="o">=</span> <span class="nt">true</span>
<span class="nt">processes</span> <span class="o">=</span> <span class="nt">8</span>
<span class="nt">cheaper</span> <span class="o">=</span> <span class="nt">2</span>

<span class="nt">logto</span> <span class="o">=</span> <span class="o">/</span><span class="nt">var</span><span class="o">/</span><span class="nt">log</span><span class="o">/</span><span class="nt">filebin</span><span class="o">/</span><span class="nt">php</span>
<span class="o">;</span><span class="nt">rotate</span> <span class="nt">logs</span> <span class="nt">when</span> <span class="nt">filesize</span> <span class="nt">is</span> <span class="nt">higher</span> <span class="nt">than</span> <span class="nt">20</span> <span class="nt">megs</span>
<span class="nt">log-maxsize</span> <span class="o">=</span> <span class="nt">20971520</span>

<span class="o">;</span> <span class="nt">map</span> <span class="nt">php</span> <span class="nt">modifier</span> <span class="nt">as</span> <span class="nt">the</span> <span class="nt">default</span>
<span class="nt">static-skip-ext</span> <span class="o">=</span> <span class="p">.</span><span class="nc">php</span>
<span class="nt">php-allowed-ext</span> <span class="o">=</span> <span class="p">.</span><span class="nc">php</span>
<span class="nt">php-allowed-ext</span> <span class="o">=</span> <span class="p">.</span><span class="nc">inc</span>
<span class="nt">php-index</span> <span class="o">=</span> <span class="nt">index</span><span class="p">.</span><span class="nc">php</span>

<span class="o">;</span> <span class="nt">show</span> <span class="nt">config</span> <span class="nt">tree</span> <span class="nt">on</span> <span class="nt">startup</span><span class="o">,</span> <span class="nt">just</span> <span class="nt">to</span> <span class="nt">see</span>
<span class="o">;</span> <span class="nt">how</span> <span class="nt">cool</span> <span class="nt">is</span> <span class="nt">1</span><span class="p">.</span><span class="nc">1</span> <span class="nt">config</span> <span class="nt">logic</span>
<span class="nt">show-config</span> <span class="o">=</span> <span class="nt">true</span>
</pre></div>


<p>Then I just have to enable and start uwsgi@paste.socket and reload nginx.</p>
<h1>fb-client</h1>
<p>For fbclient, just add <code>pastebin=&lt;yourdomain&gt;</code> to ~/.config/fb-client/config and put your
apikey in ~/.config/fb-client/apikey.  And thats it!</p>
<p><img alt="Otter Cups" src="http://24.media.tumblr.com/96650b63d82b941132ef103b3e9b9581/tumblr_mhym5ps8zn1rikt3no1_400.gif"></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://blog.gtmanfred.com/tag/pastebin.html">pastebin</a>
    </p>
  </div>





<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'gtmanfred';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  </p>
<p>Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " GTmanfred ",
  "url" : "https://blog.gtmanfred.com",
  "image": "https://blog.gtmanfred.com/images/profile.png",
  "description": ""
}
</script>

</body>
</html>